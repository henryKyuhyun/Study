# Forward Proxy & Reverse Proxy & Load Balancer

# Proxy란 ?

프록시(Proxy)는 ‘대리’의 의미로, 인터넷과 관련해서 쓰이는 경우, 특히 내부 네트워크에서 인터넷 접속을 할 때에, 빠른 액세스나 안전한 통신등을 확보하기 위한 중계서버를 ‘프록시 서버’ 라고 일컫는다. 클라이언트와 Web서버의 중간에 위치하고 있어, 대신 통신을 받아주는 것이 프록시 서버이다.

## Forward Proxy(포워드프록시)

**포워드프록시는 클라이언트를 대신하여 프록시서버가 목적 서버와 통신하는 구조이다.**  이 구조에서 프록시 서버는 외부 웹 서버와 직접 통신하며, 클라이언트는 이 프록시 서버를 통해서만 정보를 얻게 됩니다. 이 과정에서 웹서버에는 프록시 서버를 통한 접근 로그가 남게 됩니다. 클라이언트는 사용할 특정 프록시 서버를 직접 설정할 수 있습니다.

<img src="/img/ForwardProxy&Reverse1.img">

포워드 프록시의 경우 아래와 같이 프록시 서버가 외부 Web 서버와 통신한다. 그로므로 클라이언트는 프록시 서버만을 통해 정보를 얻게된다. 따라서 Web 서버쪽에서는 프록시 서버를 통한 엑세스 로그가 남는다. 

<img src="/img/ForwardProxy&Reverse2.png">

그리고 포워드 프록시의 경우는 어떤 프록시 서버를 경우하도록 할 것인가는 클라이언트가 설정 할 수 있다. 

Forward Proxy의 장점 :

- 캐시 저장
    - **프록시 서버는 웹 페이지의 캐시를 저장할 수 있으며, 동일한 페이지에 대한 후속 요청은 저장된 캐시로부터 빠르게 제공됩니다. 이를 통해 웹 사이트 접속 속도가 향상됩니다.**

<img src="/img/ForwardProxy&Reverse3.png">

- URL 필터링
    - **모든 외부 액세스가 프록시 서버를 경유함으로써, 관리자는 사용자의 외부 웹 사이트 액세스를 효과적으로 필터링할 수 있습니다. 예를 들어, `http://example1.co.jp`에 대한 액세스 시도는 설정에 따라 차단되어 에러 페이지가 표시될 수 있습니다.**
        
<img src="/img/ForwardProxy&Reverse4.png">

        
    

## Reverse Proxy (리버스 프록시)

A 라는 회사가 [example.com](http://example.com) 이라는 고객용 웹 서비스를 만들었을 경우 이를 서비스하기위해서는 리버스 프록시에 대한 이해가 필수이다.

리버스 프락시로 웹 서버를 설정할 경우 사용자가 [example.com](http://example.com/) 웹 서비스에 데이타를 요청하면 Reverse Proxy 는 이 요청을 받아서 내부 서버(보통 WAS 입니다)에서 데이타를 받은후에 이 데이타를 사용자에게 다시 전달하게 됩니다.

<img src="/img/ForwardProxy&Reverse5.png">


**대부분의 WAS 는 Web Server 기능을 제공하므로 Reverse proxy 가 없이 내부 WAS 가 직접 서비스를 제공해도 되지만 이렇게 구성하는 이유중 여러가지가 있습니다.**

## **Reverse Proxy 장점**

### **보안**

**보통 기업의 네트워크 환경은 비무장 지대(DMZ; Demilitarized Zone) 라고 하는 내부 네트워크와 외부 네트워크 사이에 위치하는 구간이 존재합니다.**

<img src="/img/ForwardProxy&Reverse6.png">


**위 그림과 같이 DMZ 내에 외부에 서비스를 제공하는 서버(메일 서버, 웹 서버, DNS 서버)를 배치하고 네트워크는 1, 2차 방화벽으로 보호합니다.**

**example.com 서비스를 제공하려면 WAS 를 DMZ 에 놓고 서비스해도 되지만 이런 서비스는 보통 내부의 DBMS 서버와 연결되어 있습니다.**

**만약 WAS 가 최전방에 있으면 WAS 가 털릴 경우 DBMS 와 관련 서버까지 모두 같이 털리는 심각한 보안 문제가 발생할 수 있습니다.**

**이때문에 DMZ 존에 웹 서버를 두고 리버스 프락시로 설정하고 WAS 는 내부망에 위치시키게 설정합니다.**

**리버스 프락시로 동작하는 웹 서버만 내부 WAS 와 연결하도록 설정하므로 웹 서버가 해킹당해도 2차 방화벽을 다시 뚫어야 하므로 더 보안에 강해질 수 있습니다.**

**특히 Red Hat 이나 CentOS 라면 [SELinux 를 켜 놓으면 SELinux 의 강제 접근 통제](https://www.lesstif.com/ws/selinux-43843892.html)에 따라 웹 서버는 사전 정해진 포트(예: WAS 의 8080, 8009)만 접근 할 수 있으므로 웹 서버가 해킹당해도 2차 피해를 최소화할 수 있습니다.**

### **속도(Speed) 와 안정성**

**reverse proxy 개념을 이해하고 구성하면 이 앞에 Cache Server 를 붙이거나 SSL 하드웨어 가속기를 연동하는등 아키텍처 측면에서 성능 향상을 하기가 용이해 집니다.**

**아주 심플하게 생각하면 cloudflare 나 akamai 같은 CDN 도 Reverse proxy 로 동작하는 캐시 서버일뿐이니까요.**

**CDN 을 연동한다면 DDOS 공격을 효과적으로 방어하고 서비스를 빠르고 안정적으로 제공할 수 있습니다.**

### **신뢰성(reliability) 증대**

**리버시 프락시를 cluster로 구성해 놓으면 가용성을 높일 수 있고 사용자가 증가하는 상황에 맞게 Web Server 나 WAS 를 유연하게 늘릴 수 있는 장점이 있습니다.**

**리버스 프록시 앞에 L4 나 load balancer 를 붙이면 Round Robin(RR), Least connection 등 상황에 맞는 분배 알고리즘을 적용해 서비스 신뢰성을 높일 수 있습니다.**

## 로드 밸런서(Load Balancer) ⇒

- 여러 서버 간에 네트워크 트래픽이나 요청을 분산시켜주는 장치나 소프트웨어를 말합니다. 주로 고가용성, 높은 성능, 그리고 안정적인 서비스 제공을 위해 사용됩니다. 로드 밸런서는 다수의 서버가 작업을 공유함으로써 단일 서버에 발생할 수 있는 과부하를 방지하고, 서비스으 가용성과 신뢰성을 증가시킵니다.
- 로드밸런서(Load Balancer)는 클라이언트와 서버 그룹 사이에 위치해 서버에 가해지는 트래픽을 여러 대의 서버에 고르게 분배하여 특정 서버의 부하를 덜어줍니다. 서버가 하나인데 많은 트래픽이 몰릴 경우 부하를 감당하지 못하고, 서버가 다운되어 서비스가 작동을 멈출 수 있습니다. 이런 문제를 해결하기 위해서 Scale up(스케일업)과 Scale out(스케일아웃) 방식 중 한 가지를 사용해 해결합니다.

<img src="/img/ForwardProxy&Reverse7.png">


### 로드 밸런서의 주요기능 ⇒

- 트래픽분산
    - 로드 밸런서는 들어오는 네트워크 트래픽을 여러 버서에 고르게 분산시켜 각 서버의 부하를 최적화합니다. 이를 통해 어느 한 서버에 과부하가 걸리는것을 방지합니다
- 가용성 향상
    - 서버 중 하나가 고장 나거나 유지보수가 필요할 경우, 로드 밸런서는 자동으로 트래픽을 건강한 서버로 전환하여 서비스 중단 없이 지속적인 서비스를 제공할 수 있게합니다.
- 스케일링
    - 트래픽의 증가에 따라 추가적인 서버를 쉽게 추가할 수 있으며, 로드 밸런서가 자동으로 새로운 서버에 트래픽을 분산시켜 처리능력을 확장할 수 있습니다
- 보안 강화
    - 로드 밸런서는 어플이케이션 서버 앞에서 요청을 사전에 처리함으로써 일부 보안 위협으로부터 어플리케이션 서버를 보호하는 역할을 수행합니다.
    

### 종류 ⇒

L4 로드밸런서 : 네트워크 계층(OSI 모델의 4계층) 에서 작동하여 IP 주소와 포트 번호를 기반으로 트래픽을 분산합니다

L7 로드밸런서 : 어플리케이션 계층 (OSI 모델의 7계층) 에서 작동하여 HTTP header, cookie, request URI 등과 같은 어플리케이션 수준의 정보를 기반으로 트랙픽을 분산합니다

로드 밸런서는 클라우드 컴퓨터 환경, 대규모 웹사이트, 온라인 서비스 제공업체 등 다양한 분야에서 중요하게 활용되고 있습니다.

참고 : [https://www.smileshark.kr/post/what-is-a-load-balancer-a-comprehensive-guide-to-aws-load-balancer#viewer-322ei](https://www.smileshark.kr/post/what-is-a-load-balancer-a-comprehensive-guide-to-aws-load-balancer#viewer-322ei)