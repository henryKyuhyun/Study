# NGINX 와 Apache란 ?

![Screenshot 2024-03-11 at 12.45.59 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.45.59_pm.png)

- Apache의 C10K 문제점 해결을 위해 만들어진 ***Event-Driven*** 구조의 웹 서버 소프트웨어입니다. 즉, 프로그램의 흐름이 이벤트에 의해 결정되는 방식입니다.
- Nginx(엔진엑스)는 높은 성능과 안정성 그리고 현재 가장 많이 사용되고있는 웹 서버입니다.  Apache 같은 웹 서버와 비교하면 더 빠르고 가볍고, 대규모 어플리케이션 처리에 적합하다는 장점이 있습니다.
- 또한 웹사이트의 서버(AWS)를 도와주는 비동기 이벤트 기반구조의 웹서버 프로그램입니다. 
공식문서에는 “**NGINX 는 고성능, 확장성, 고가용성 웹서버, 역방향 프록시 서버 및 웹 가속기(HTTP 로드밸런서 , 콘텐츠 캐시 등의 기능 결합)이다**”  라고 소개하고있습니다.

![Screenshot 2024-03-11 at 12.31.58 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.31.58_pm.png)

WebServer : 단순히 정적 파일 응답

WAS(Web Application Server) : 클라이언트 요청에 대해 동적 처리가 이뤄진 후 응답

### Nginx가 만들어진 배경

⇒ 1995년 유닉스 기반으로 만들어진 최초의 웹서버 NCSA HTTPd가 있었습니다. 하지만 버그가 굉장히 많았기 떄문에 만들어진 것이 Apache HTTP Server 입니다

아파치 서버는 요청이 들어오면 커넥션을 형성하기 위해 프로세스를 생성합니다. 즉 새로운 요청이 들어올때마다 프로세스를 새로 만듭니다 (이는 유닉스 계열 OS가 네트워크 커넥션을 형성하는 모델을 그대로 적용한것입니다.)

프로세스 생성 시간이 오래 걸리므로 요청이 들어오기 전에 프로세스를 미리 생성하는 PREFORK 방식을 사용했습니다.
그래서 새로운 클라이언트가 들어오면 미리 만들어 놓은 프로세스를 가져다 사용했습니다. 만약 만들어놓은 프로세스가 모두 할당되면 추가로 프로세스를 만들었습니다.

이런 구조는 개발하기 쉽다는 장점(확장성)이 있습니다.

![Screenshot 2024-03-11 at 12.35.53 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.35.53_pm.png)

### 웹 서버 ⇒

웹 서버는 클라이언트의 요청에 따라 HTML,CSS,Js, 이미지 파일과 같은 정적 파일을 응답하여 제공하는 소프트웨어를 말합니다. 웹 서버는 HTTP 프로토콜을 사용하여 클라이언트와 통신합니다. 대표적인 웹 서버로는 Nginx, Apache 등이 있습니다.  외에도 Microsoft IIS, Lighttpd등 다양한 웹서버가 존재합니다.

![Screenshot 2024-03-08 at 5.59.09 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-08_at_5.59.09_pm.png)

### WAS(Web Application Server) ⇒

WAS 는 클라이언트 요청에 대해 동적인 처리를 담당하는 영역입니다. 웹 서버와 달리 어프리케이션 로직을 실행할 수 있도록 구성되어있습니다. 예를 들어 회원가입이나 로그인 등의 로직을 처리하는 영역이 WAS 입니다. 또한 데이터베이스 연동, 트랜잭션 관리, 보안, 로깅 등의 기능도 제공합니다. 이를 통해 웹 어플리케이션의 안정성과 성능을 향상시키며, 개발자들은 어플리케이션 개발에 집중할 수 있습니다. 대표적인 WAS로는 Tomcat, JBoss, WebLogic, WebSphere 등이 있습니다.

웹 서버와 WAS는 역할의 차이가 있지만 현업에서는 웹 서버로 이야기하고있습니다. 참고로 Node.js는 웹서버 또는 WAS로도 사용할 수 있습니다.

![Screenshot 2024-03-08 at 6.01.41 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-08_at_6.01.41_pm.png)

보통 웹 서비스는 클라이언트 → 웹 서버 → WAS → DB순으로 **요청**이되고 역순으로 **응답**이 됩니다. 

## 주요 특징

1. Event-Driven 처리 기반 구조

![Screenshot 2024-03-11 at 12.46.45 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.46.45_pm.png)

- 한 개 또는 고정된 프로세스만 생성하고, 여러 개의 Connection을 모두 Event-Handler를 통해 비동기 방식으로 처리합니다.
- 적은 양의 스레드만 사용되기 때문에 **Context Swiching** 비용이 적고, CPU 소모가 적습니다.
- Apache와 달리 동시 접속자 수가 많아져도 추가적인 생성 비용이 들지 않습니다.
- CPU와 관계없이 모든 I/O들을 전부 Event Listener로 미루기 때문에 흐름이 끊기지 않고 응답이 빠르게 진행되어 1개의 프로세스로 더 빠른 작업이 가능합니다.이 덕분에 메모리를 적게 사용합니다.

1. 리버스 프록시로 배치 가능
- NginX의 빠른 처리 속도를 활용하여 클라이언트의 모든 요청을 처리합니다.

### 단점

- 동적 컨텐츠를 기본적으로 처리할 수 없습니다.외부 프로세서로 전달하고 렌더링 된 컨텐츠를 다시 전송할 때 까지 기다려야 합니다. (프로세스 속도 저하)
- Apache에 비해 다양한 모듈이 없습니다.

## Apache HTTP Server ⇒

Apache는 Apache Software foundation 에서 만든 웹서버 프로그램입니다. 거의 모든 OS에서 실행되고 다른 유명한 소프트웨어 프로젝트와의 문서화가 잘되어있고 통합 지원등의 이점이 있습니다.

**주요 특징**

1. 스레드 / 프로세스 기반 구조

![Screenshot 2024-03-11 at 12.41.06 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.41.06_pm.png)

⇒ Apache 는 클라이언트 요청당 하나의 스레드가 처리하는 구조입니다

⇒ 사용자가 많으면 스레드 생성, 메모리 및 CPU 낭비가 심합니다.

2.MPM(Multi-Process Module)

- PreFork MPM (다중 프로세스)
    - Client 요청에 대해 Apache 지식 프로세스를 생성하여 처리합니다.
    - 요청이 많을 경우 Process를 생성하여 처리합니다.
    이 방식은 Apache 설치 시 default로 설정되어 있습니다.
    - 하나의 **자식 프로세스당 하나의 스레드를 갖는 구조**로, 자식 프로세스는 최대 1024개까지 가능합니다.
    - **스레드 간 메모리 공유를 하지 않습**니다.이 방식은 **독립적이기에 안정적인 반면, 메모리 소모가 크다는 단점이 있습니다.**
    - 실행 중인 프로세스를 **복제하여 실행합**니다. (**메모리 영역까지 복제**)
    - 응답 프로세스를 미리 띄어놓고 클라이언트 요청 시 자식 프로세스가 반응하는 방식입니다.
    - 디버깅이 빈약한 플랫폼에서 쉬운 디버깅이 가능합니다.
    - 일반적으로 Single CPU 또는 Dual CPU에서 성능이 더 좋습니다.
        
        ![Screenshot 2024-03-11 at 12.44.52 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.44.52_pm.png)
        

- Worker  MPM (멀티 프로세스-스레드)
    - Prefork 보다 메모리 사용량이 적고, 동시 접속자가 많은 사이트에 적합합니다.각 프로세스의 스레드를 생성해 처리하는 구조입니다.
    - 스레드 간의 메모리 공유가 가능합니다.
    - 프로세스당 최대 64개의 스레드 처리가 가능하며, 각 스레드는 하나의 연결만을 부여받습니다.
    - 일반적으로 Multi CPU 시스템에서 성능이 좋습니다.
    
    ![Screenshot 2024-03-11 at 12.45.37 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.45.37_pm.png)
    
1. 동적 컨텐츠 처리
2. 다양한 모듈

### 단점

- **클라이언트 접속 시 마다 프로세스 또는 스레드를 생성하는 구조**이기에 대량의 클라이언트(1만 이상)가 동시 접속한다면 CPU/메모리 사용이 증가하고 프로세스/스레드 생성 비용이 드는 등 요청에 한계가 있습니다.
- Apache 서버의 프로세스가 blocking되면 요청을 처리하기 못하고 처리가 완료될 때 까지 계속 대기합니다.**Keep Alive**(접속 대기)를 이용해 해결이 가능하지만, Keep Alive 때문에 대량 접속 시 효율이 떨어짐

정리 : 

![Screenshot 2024-03-11 at 12.47.42 pm.png](NGINX%20%E1%84%8B%E1%85%AA%20Apache%E1%84%85%E1%85%A1%E1%86%AB%2001f787b1973d47ef8c04c3c88ac45aa1/Screenshot_2024-03-11_at_12.47.42_pm.png)

## 결론

Apache와 NginX는 모두 강력하고 유연한 웹서버입니다. 어떤 웹서버가 더 좋다 라는 결론은 없습니다. 어떤 것을 사용할 지는 요구사항과 우선순위에 따라 크게 좌우됩니다.

Apache는 대규모 커뮤니티가 있으며 일반적인 문제를 탐색하는 데 도움이 되는 많은 지원이 있고 안정성 또한 뛰어납니다. 하지만 NginX는 속도가 향상될 수 있습니다.

이러한 것들과 비용 등을 고려하여 적합한 웹 서버를 사용하면 됩니다.